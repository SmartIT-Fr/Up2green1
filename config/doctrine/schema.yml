partenaire:
  actAs: [Timestampable]
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true
    title:
      type: string(45)
      default: null
    accroche:
      type: string(1000)
      default: null
    description:
      type: clob(65535)
      default: null
    url:
      type: string(150)
      default: null

partenaireUser:
  options:
    symfony:
      form: false
      filter: false
  columns:
    partenaire_id:
      type: integer(4)
      primary: true
      notnull: true
    user_id:
      type: bigint(20) 
      primary: true
      notnull: true
  relations:
    User:
      class: sfGuardUser
      local: user_id
      foreignType: one
      foreignAlias: Partenaire
    partenaire:
      class: partenaire
      local: partenaire_id
      foreign: id
      foreignAlias: partenaireUsers
      
profil:
  columns:
    id:
      type: integer(4)
      primary: true
      notnull: true
      autoincrement: true
    user_id:
      type: bigint(20) 
      notnull: true
      unique: true
    credit:
      type: integer(4)
      notnull: true
      default: 0
    is_newsletter:
      type: integer(1)
      notnull: true
      default: 0
    culture:
      type: string(7)
      default: 'fr_FR'
  relations:
    User:
      class: sfGuardUser
      local: user_id
      onDelete: CASCADE
      foreignType:  one
      foreignAlias: Profile

coupon:
  actAs: [Timestampable]
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true
    code:
      type: string(128)
      unique: true
      notnull: true
    credit:
      type: integer(4)
      notnull: true
      default: 1
    is_active:
      type: boolean
      default: 1
    used_at:
      type: timestamp
      default: null
    used_by:
      type: integer(4)
      default: null

userCoupon:
  options:
    symfony:
      form: false
      filter: false
  columns:
    user_id:
      type: bigint(20) 
      primary: true
      notnull: true
    coupon_id:
      type: integer(4)
      primary: true
      notnull: true
  relations:
    User:
      class: sfGuardUser
      local: user_id
      onDelete: CASCADE
      foreignAlias: Coupons
    coupon:
      class: coupon
      local: coupon_id
      foreign: id
      foreignAlias: User

organisme:
  actAs: 
    Timestampable: ~
    I18n:
      fields: [title, accroche, description]
      actAs:
        Sluggable: { fields: [title], uniqueBy: [lang, title] }
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true
    url:
      type: string(128)
    title:
      type: string(128)
    accroche:
      type: string(1000)
    description:
      type: clob(65535)
    logo:
      type: string(128)
      default: null

programme:
  actAs: 
    Timestampable: ~
    I18n:
      fields: [title, accroche, description]
      actAs:
        Sluggable: { fields: [title], uniqueBy: [lang, title] }
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true
    organisme_id:
      type: integer(4)
      default: null
    title:
      type: string(128)
    accroche:
      type: string(1000)
    description:
      type: clob(65535)
    geoadress:
      type: string(255)
      default: null
    latitude:
      type: decimal
      scale: 6
      default: null
    longitude:
      type: decimal
      scale: 6
      default: null
    is_active:
      type: boolean
      default: 1
    max_tree:
      type: integer(4)
      notnull: true
    logo:
      type: string(128)
      default: null
  relations:
    Organisme:
      class: organisme
      local: organisme_id
      foreignAlias: Programmes

tree:
  actAs: [Timestampable]
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true

treeProgramme:
  options:
    symfony:
      form: false
      filter: false
  columns:
    programme_id:
      type: integer(4)
      primary: true
      notnull: true
    tree_id:
      type: integer(4)
      primary: true
      notnull: true
  relations:
    tree:
      class: tree
      local: tree_id
      foreign: id
      foreignType: one
      foreignAlias: Programme
    programme:
      class: programme
      local: programme_id
      foreign: id
      foreignAlias: Trees

userTree:
  options:
    symfony:
      form: false
      filter: false
  columns:
    user_id:
      type: bigint(20) 
      primary: true
      notnull: true
    tree_id:
      type: integer(4)
      primary: true
      notnull: true
  relations:
    User:
      class: sfGuardUser
      local: user_id
      onDelete: CASCADE
      foreignAlias: Trees
    tree:
      class: tree
      local: tree_id
      foreign: id
      foreignAlias: userTree

article:
  actAs: 
    Timestampable: ~
    I18n:
      fields: [title, accroche, description]
      actAs:
        Sluggable: { fields: [title], uniqueBy: [lang, title] }
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true
    category_id:
      type: integer(4)
    title:
      type: string(255)
      notnull: true
    accroche:
      type: string(1000)
    description:
      type: clob(65535)
    logo:
      type: string(255)
    is_active:
      type: boolean
      default: 0
  relations:
    Category:
      class: category
      local: category_id
      foreignAlias: Articles

newsletter:
  actAs: 
    Timestampable: ~
    I18n:
      fields: [title, content]
      actAs:
        Sluggable: { fields: [title], uniqueBy: [lang, title] }
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true
    category_id:
      type: integer(4)
    title:
      type: string(255)
      notnull: true
    content:
      type: clob(65535)
    reply_to:
      type: string(128)
      notnull: true
      default: noreply@up2green.com
    email_from:
      type: string(128)
      notnull: true
      default: newsletter@up2green.com
    is_forced:
      type: boolean
      default: 0
    sent_at:
      type: timestamp
  relations:
    category:
      class: category
      local: category_id
      foreignAlias: Newsletters

lien:
  actAs:
    Timestampable: ~
    I18n:
      fields: [title]
      actAs:
        Sluggable: { fields: [title], uniqueBy: [lang, title] }
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true
    category_id:
      type: integer(4)
    title:
      type: string(255)
      notnull: true
    src:
      type: string(255)
    is_active:
      type: boolean
      default: 0 
    rank:
      type: integer(4)
      notnull: true
      default: 1
  relations:
    category:
      class: category
      local: category_id
      foreignAlias: Liens
      
category:
  actAs: 
    NestedSet:
      hasManyRoots: true
      rootColumnName: root_id
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true
    unique_name:
      type: string(30)
      unique: true
    is_active:
      type: boolean
      default: 1
     
layout:
  actAs: [Timestampable]
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true
    name:
      type: string(128)
      notnull: true
    unique_name:
      type: string(128)
      notnull: true
      unique: true

zone:
  actAs: [Timestampable]
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true
    name:
      type: string(128)
      notnull: true
    unique_name:
      type: string(128)
      notnull: true
      unique: true

module:
  actAs: [Timestampable]
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true
    content_id:
      type: string(128)
      notnull: true
    content_type:
      type: enum
      values: [category, lien, article, newsletter, programme, organisme, gmap, recherche, user, sgGuardAuth]
    is_active:
      type: boolean
      default: 0
    action:
      type: string(128)
    user_access:
      type: string(128)
      
content: 
  actAs: [Timestampable]
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true 
    layout_id:
      type: integer(4)
      primary: true
      notnull: true
    zone_id:
      type: integer(4)
      primary: true
      notnull: true
    module_id:
      type: integer(4)
      primary: true
      notnull: true      
  relations:
    layout:
      class: layout
      local: layout_id
      foreign: id
      foreignAlias: layoutContents
    zone:
      class: zone
      local: zone_id
      foreign: id
      foreignAlias: zoneContents
    module:
      local: module_id
      onDelete: CASCADE
      
engine:
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true
    url:
      type: string(128)
      notnull: true      
    html:
      type: string(128)
      notnull: true
    description:
      type: string(128)
    remun_type:
      type: enum
      values: [number, pourcent, price]
    remun_min:
      type: integer(4)
      notnull: true
      default: 0      
    remun_max:
      type: integer(4)
      notnull: true
    rank:
      type: integer(4)
      notnull: true
      
tag:
  actAs: [Timestampable]
  columns:
    id:
      type: integer(4)
      primary: true
      autoincrement: true
    label:
      type: string(255)
      notnull: true
      unique: true
    rank:
      type: integer(4)
      notnull: true
      default: 0
    is_active:
      type: boolean
      default: 1 
            
engineTag:
  options:
    symfony:
      form:   false
      filter: false
  columns:
    engine_id:
      type: integer(4)
      primary: true
      notnull: true
    tag_id:
      type: integer(4)
      primary: true
      notnull: true
  relations:
    engine:
      local: engine_id
      onDelete: CASCADE
    tag:
      local: tag_id
      onDelete: CASCADE
